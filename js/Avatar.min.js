var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{var a=document.createElement("canvas");return !!(window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl")));}catch(b){return false;}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";if(!this.webgl){a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n");}return a;},addGetWebGLMessage:function(d){var c,b,a;d=d||{};c=d.parent!==undefined?d.parent:document.body;b=d.id!==undefined?d.id:"oldie";a=Detector.getWebGLErrorMessage();a.id=b;c.appendChild(a);}};if(typeof module==="object"){module.exports=Detector;}THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(b,c){};this.setValues(a);};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();a.copy(this);a.color.copy(this.color);a.program=this.program;return a;};THREE.CanvasRenderer=function(aE){console.log("THREE.CanvasRenderer",THREE.REVISION);aE=aE||{};var t=this,K,D,J,l=new THREE.Projector(),ai=aE.canvas!==undefined?aE.canvas:document.createElement("canvas"),ab=ai.width,ap=ai.height,aB=Math.floor(ab/2),z=Math.floor(ap/2),X=0,E=0,aa=ab,d=ap,x=1,ah=ai.getContext("2d",{alpha:aE.alpha===true}),g=new THREE.Color(0),aM=aE.alpha===true?0:1,ag=1,aK=0,y=null,m=null,p=null,aD=null,e=null,aN=[],v,s,c,P,w,V=new THREE.RenderableVertex(),A=new THREE.RenderableVertex(),ar,aH,av,N,az,an,F,U,aI,T,aL,S,am=new THREE.Color(),u=new THREE.Color(),r=new THREE.Color(),b=new THREE.Color(),I=new THREE.Color(),aw=new THREE.Color(),G=new THREE.Color(),j=new THREE.Color(),ac={},W,af,R,ay,Y,aO,k,ak,at=new THREE.Box2(),ae=new THREE.Box2(),C=new THREE.Box2(),aA=new THREE.Color(),Q=new THREE.Color(),n=new THREE.Color(),i=new THREE.Vector3(),al=new THREE.Vector3(),aj=new THREE.Vector3(),ao=new THREE.Matrix3();if(ah.setLineDash===undefined){ah.setLineDash=function(){};}this.domElement=ai;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return ah;};this.getContextAttributes=function(){return ah.getContextAttributes();};this.getPixelRatio=function(){return x;};this.setPixelRatio=function(aQ){if(aQ!==undefined){x=aQ;}};this.setSize=function(aR,aQ,aS){ab=aR*x;ap=aQ*x;ai.width=ab;ai.height=ap;aB=Math.floor(ab/2);z=Math.floor(ap/2);if(aS!==false){ai.style.width=aR+"px";ai.style.height=aQ+"px";}at.min.set(-aB,-z);at.max.set(aB,z);ae.min.set(-aB,-z);ae.max.set(aB,z);ag=1;aK=0;y=null;m=null;p=null;aD=null;e=null;this.setViewport(0,0,aR,aQ);};this.setViewport=function(aS,aT,aR,aQ){X=aS*x;E=aT*x;aa=aR*x;d=aQ*x;};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(aR,aQ){g.set(aR);aM=aQ!==undefined?aQ:1;ae.min.set(-aB,-z);ae.max.set(aB,z);};this.setClearColorHex=function(aR,aQ){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aR,aQ);};this.getClearColor=function(){return g;};this.getClearAlpha=function(){return aM;};this.getMaxAnisotropy=function(){return 0;};this.clear=function(){if(ae.empty()===false){ae.intersect(at);ae.expandByScalar(2);ae.min.x=ae.min.x+aB;ae.min.y=-ae.min.y+z;ae.max.x=ae.max.x+aB;ae.max.y=-ae.max.y+z;if(aM<1){ah.clearRect(ae.min.x|0,ae.max.y|0,(ae.max.x-ae.min.x)|0,(ae.min.y-ae.max.y)|0);}if(aM>0){ax(THREE.NormalBlending);au(1);L("rgba("+Math.floor(g.r*255)+","+Math.floor(g.g*255)+","+Math.floor(g.b*255)+","+aM+")");ah.fillRect(ae.min.x|0,ae.max.y|0,(ae.max.x-ae.min.x)|0,(ae.min.y-ae.max.y)|0);}ae.makeEmpty();}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(aV,aQ){if(aQ instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return;}if(this.autoClear===true){this.clear();}t.info.render.vertices=0;t.info.render.faces=0;ah.setTransform(aa/ab,0,0,-d/ap,X,ap-E);ah.translate(aB,z);K=l.projectScene(aV,aQ,this.sortObjects,this.sortElements);D=K.elements;J=K.lights;v=aQ;ao.getNormalMatrix(aQ.matrixWorldInverse);aJ();for(var aT=0,aU=D.length;aT<aU;aT++){var aR=D[aT];var aS=aR.material;if(aS===undefined||aS.opacity===0){continue;}C.makeEmpty();if(aR instanceof THREE.RenderableSprite){s=aR;s.x*=aB;s.y*=z;B(s,aR,aS);}else{if(aR instanceof THREE.RenderableLine){s=aR.v1;c=aR.v2;s.positionScreen.x*=aB;s.positionScreen.y*=z;c.positionScreen.x*=aB;c.positionScreen.y*=z;C.setFromPoints([s.positionScreen,c.positionScreen]);if(at.isIntersectionBox(C)===true){aG(s,c,aR,aS);}}else{if(aR instanceof THREE.RenderableFace){s=aR.v1;c=aR.v2;P=aR.v3;if(s.positionScreen.z<-1||s.positionScreen.z>1){continue;}if(c.positionScreen.z<-1||c.positionScreen.z>1){continue;}if(P.positionScreen.z<-1||P.positionScreen.z>1){continue;}s.positionScreen.x*=aB;s.positionScreen.y*=z;c.positionScreen.x*=aB;c.positionScreen.y*=z;P.positionScreen.x*=aB;P.positionScreen.y*=z;if(aS.overdraw>0){o(s.positionScreen,c.positionScreen,aS.overdraw);o(c.positionScreen,P.positionScreen,aS.overdraw);o(P.positionScreen,s.positionScreen,aS.overdraw);}C.setFromPoints([s.positionScreen,c.positionScreen,P.positionScreen]);if(at.isIntersectionBox(C)===true){f(s,c,P,0,1,2,aR,aS);}}}}ae.union(C);}ah.setTransform(1,0,0,1,0,0);};function aJ(){aA.setRGB(0,0,0);Q.setRGB(0,0,0);
n.setRGB(0,0,0);for(var aQ=0,aR=J.length;aQ<aR;aQ++){var aT=J[aQ];var aS=aT.color;if(aT instanceof THREE.AmbientLight){aA.add(aS);}else{if(aT instanceof THREE.DirectionalLight){Q.add(aS);}else{if(aT instanceof THREE.PointLight){n.add(aS);}}}}}function q(aX,aU,aV){for(var aQ=0,aW=J.length;aQ<aW;aQ++){var aS=J[aQ];j.copy(aS.color);if(aS instanceof THREE.DirectionalLight){var aT=i.setFromMatrixPosition(aS.matrixWorld).normalize();var aR=aU.dot(aT);if(aR<=0){continue;}aR*=aS.intensity;aV.add(j.multiplyScalar(aR));}else{if(aS instanceof THREE.PointLight){var aT=i.setFromMatrixPosition(aS.matrixWorld);var aR=aU.dot(i.subVectors(aT,aX).normalize());if(aR<=0){continue;}aR*=aS.distance==0?1:1-Math.min(aX.distanceTo(aT)/aS.distance,1);if(aR==0){continue;}aR*=aS.intensity;aV.add(j.multiplyScalar(aR));}}}}function B(a3,a2,aS){au(aS.opacity);ax(aS.blending);var aT=a2.scale.x*aB;var aV=a2.scale.y*z;var aW=0.5*Math.sqrt(aT*aT+aV*aV);C.min.set(a3.x-aW,a3.y-aW);C.max.set(a3.x+aW,a3.y+aW);if(aS instanceof THREE.SpriteMaterial){var aY=aS.map;if(aY!==null){var aZ=ac[aY.id];if(aZ===undefined||aZ.version!==aY.version){aZ=H(aY);ac[aY.id]=aZ;}if(aZ.canvas!==undefined){L(aZ.canvas);var a0=aY.image;var aU=a0.width*aY.offset.x;var aQ=a0.height*aY.offset.y;var a4=a0.width*aY.repeat.x;var a1=a0.height*aY.repeat.y;var aR=aT/a4;var aX=aV/a1;ah.save();ah.translate(a3.x,a3.y);if(aS.rotation!==0){ah.rotate(aS.rotation);}ah.translate(-aT/2,-aV/2);ah.scale(aR,aX);ah.translate(-aU,-aQ);ah.fillRect(aU,aQ,a4,a1);ah.restore();}}else{L(aS.color.getStyle());ah.save();ah.translate(a3.x,a3.y);if(aS.rotation!==0){ah.rotate(aS.rotation);}ah.scale(aT,-aV);ah.fillRect(-0.5,-0.5,1,1);ah.restore();}}else{if(aS instanceof THREE.SpriteCanvasMaterial){ad(aS.color.getStyle());L(aS.color.getStyle());ah.save();ah.translate(a3.x,a3.y);if(aS.rotation!==0){ah.rotate(aS.rotation);}ah.scale(aT,aV);aS.program(ah);ah.restore();}}}function aG(aV,aX,aU,aQ){au(aQ.opacity);ax(aQ.blending);ah.beginPath();ah.moveTo(aV.positionScreen.x,aV.positionScreen.y);ah.lineTo(aX.positionScreen.x,aX.positionScreen.y);if(aQ instanceof THREE.LineBasicMaterial){M(aQ.linewidth);O(aQ.linecap);aP(aQ.linejoin);if(aQ.vertexColors!==THREE.VertexColors){ad(aQ.color.getStyle());}else{var aR=aU.vertexColors[0].getStyle();var aT=aU.vertexColors[1].getStyle();if(aR===aT){ad(aR);}else{try{var aW=ah.createLinearGradient(aV.positionScreen.x,aV.positionScreen.y,aX.positionScreen.x,aX.positionScreen.y);aW.addColorStop(0,aR);aW.addColorStop(1,aT);}catch(aS){aW=aR;}ad(aW);}}ah.stroke();C.expandByScalar(aQ.linewidth*2);}else{if(aQ instanceof THREE.LineDashedMaterial){M(aQ.linewidth);O(aQ.linecap);aP(aQ.linejoin);ad(aQ.color.getStyle());Z([aQ.dashSize,aQ.gapSize]);ah.stroke();C.expandByScalar(aQ.linewidth*2);Z([]);}}}function f(aU,aV,aY,aS,aX,aQ,aT,aR){t.info.render.vertices+=3;t.info.render.faces++;au(aR.opacity);ax(aR.blending);ar=aU.positionScreen.x;aH=aU.positionScreen.y;av=aV.positionScreen.x;N=aV.positionScreen.y;az=aY.positionScreen.x;an=aY.positionScreen.y;h(ar,aH,av,N,az,an);if((aR instanceof THREE.MeshLambertMaterial||aR instanceof THREE.MeshPhongMaterial)&&aR.map===null){aw.copy(aR.color);G.copy(aR.emissive);if(aR.vertexColors===THREE.FaceColors){aw.multiply(aT.color);}am.copy(aA);al.copy(aU.positionWorld).add(aV.positionWorld).add(aY.positionWorld).divideScalar(3);q(al,aT.normalModel,am);am.multiply(aw).add(G);aR.wireframe===true?a(am,aR.wireframeLinewidth,aR.wireframeLinecap,aR.wireframeLinejoin):aq(am);}else{if(aR instanceof THREE.MeshBasicMaterial||aR instanceof THREE.MeshLambertMaterial||aR instanceof THREE.MeshPhongMaterial){if(aR.map!==null){var aW=aR.map.mapping;if(aW===THREE.UVMapping){af=aT.uvs;aC(ar,aH,av,N,az,an,af[aS].x,af[aS].y,af[aX].x,af[aX].y,af[aQ].x,af[aQ].y,aR.map);}}else{if(aR.envMap!==null){if(aR.envMap.mapping===THREE.SphericalReflectionMapping){aj.copy(aT.vertexNormalsModel[aS]).applyMatrix3(ao);R=0.5*aj.x+0.5;ay=0.5*aj.y+0.5;aj.copy(aT.vertexNormalsModel[aX]).applyMatrix3(ao);Y=0.5*aj.x+0.5;aO=0.5*aj.y+0.5;aj.copy(aT.vertexNormalsModel[aQ]).applyMatrix3(ao);k=0.5*aj.x+0.5;ak=0.5*aj.y+0.5;aC(ar,aH,av,N,az,an,R,ay,Y,aO,k,ak,aR.envMap);}}else{am.copy(aR.color);if(aR.vertexColors===THREE.FaceColors){am.multiply(aT.color);}aR.wireframe===true?a(am,aR.wireframeLinewidth,aR.wireframeLinecap,aR.wireframeLinejoin):aq(am);}}}else{if(aR instanceof THREE.MeshNormalMaterial){aj.copy(aT.normalModel).applyMatrix3(ao);am.setRGB(aj.x,aj.y,aj.z).multiplyScalar(0.5).addScalar(0.5);aR.wireframe===true?a(am,aR.wireframeLinewidth,aR.wireframeLinecap,aR.wireframeLinejoin):aq(am);}else{am.setRGB(1,1,1);aR.wireframe===true?a(am,aR.wireframeLinewidth,aR.wireframeLinecap,aR.wireframeLinejoin):aq(am);}}}}function h(aU,aQ,aT,aR,aV,aS){ah.beginPath();ah.moveTo(aU,aQ);ah.lineTo(aT,aR);ah.lineTo(aV,aS);ah.closePath();}function a(aT,aQ,aS,aR){M(aQ);O(aS);aP(aR);ad(aT.getStyle());ah.stroke();C.expandByScalar(aQ*2);}function aq(aQ){L(aQ.getStyle());ah.fill();}function H(aU){if(aU.version===0||aU instanceof THREE.CompressedTexture||aU instanceof THREE.DataTexture){return{canvas:undefined,version:aU.version};
}var aV=aU.image;var aR=document.createElement("canvas");aR.width=aV.width;aR.height=aV.height;var aT=aR.getContext("2d");aT.setTransform(1,0,0,-1,0,aV.height);aT.drawImage(aV,0,0);var aW=aU.wrapS===THREE.RepeatWrapping;var aS=aU.wrapT===THREE.RepeatWrapping;var aQ="no-repeat";if(aW===true&&aS===true){aQ="repeat";}else{if(aW===true){aQ="repeat-x";}else{if(aS===true){aQ="repeat-y";}}}return{canvas:ah.createPattern(aR,aQ),version:aU.version};}function aC(aS,a9,aQ,a3,a4,a5,a8,aY,aW,a2,a6,bf,a0){var a1=ac[a0.id];if(a1===undefined||a1.version!==a0.version){a1=H(a0);ac[a0.id]=a1;}if(a1.canvas!==undefined){L(a1.canvas);}else{L("rgba( 0, 0, 0, 1)");ah.fill();return;}var aV,aX,ba,bc,aT,be,bd,aZ,aR=a0.offset.x/a0.repeat.x,aU=a0.offset.y/a0.repeat.y,bb=a0.image.width*a0.repeat.x,a7=a0.image.height*a0.repeat.y;a8=(a8+aR)*bb;aY=(aY+aU)*a7;aW=(aW+aR)*bb;a2=(a2+aU)*a7;a6=(a6+aR)*bb;bf=(bf+aU)*a7;aQ-=aS;a3-=a9;a4-=aS;a5-=a9;aW-=a8;a2-=aY;a6-=a8;bf-=aY;bd=aW*bf-a6*a2;if(bd===0){return;}aZ=1/bd;aV=(bf*aQ-a2*a4)*aZ;aX=(bf*a3-a2*a5)*aZ;ba=(aW*a4-a6*aQ)*aZ;bc=(aW*a5-a6*a3)*aZ;aT=aS-aV*a8-ba*aY;be=a9-aX*a8-bc*aY;ah.save();ah.transform(aV,aX,ba,bc,aT,be);ah.fill();ah.restore();}function aF(aS,aY,aR,ba,bc,aQ,aX,a2,a0,a9,aV,bb,aU){var aZ,a1,a3,a6,aT,a8,a7,a4,a5=aU.width-1,aW=aU.height-1;aX*=a5;a2*=aW;a0*=a5;a9*=aW;aV*=a5;bb*=aW;aR-=aS;ba-=aY;bc-=aS;aQ-=aY;a0-=aX;a9-=a2;aV-=aX;bb-=a2;a7=a0*bb-aV*a9;a4=1/a7;aZ=(bb*aR-a9*bc)*a4;a1=(bb*ba-a9*aQ)*a4;a3=(a0*bc-aV*aR)*a4;a6=(a0*aQ-aV*ba)*a4;aT=aS-aZ*aX-a3*a2;a8=aY-a1*aX-a6*a2;ah.save();ah.transform(aZ,a1,a3,a6,aT,a8);ah.clip();ah.drawImage(aU,0,0);ah.restore();}function o(aR,aT,aW){var aV=aT.x-aR.x,aS=aT.y-aR.y,aQ=aV*aV+aS*aS,aU;if(aQ===0){return;}aU=aW/Math.sqrt(aQ);aV*=aU;aS*=aU;aT.x+=aV;aT.y+=aS;aR.x-=aV;aR.y-=aS;}function au(aQ){if(ag!==aQ){ah.globalAlpha=aQ;ag=aQ;}}function ax(aQ){if(aK!==aQ){if(aQ===THREE.NormalBlending){ah.globalCompositeOperation="source-over";}else{if(aQ===THREE.AdditiveBlending){ah.globalCompositeOperation="lighter";}else{if(aQ===THREE.SubtractiveBlending){ah.globalCompositeOperation="darker";}}}aK=aQ;}}function M(aQ){if(p!==aQ){ah.lineWidth=aQ;p=aQ;}}function O(aQ){if(aD!==aQ){ah.lineCap=aQ;aD=aQ;}}function aP(aQ){if(e!==aQ){ah.lineJoin=aQ;e=aQ;}}function ad(aQ){if(y!==aQ){ah.strokeStyle=aQ;y=aQ;}}function L(aQ){if(m!==aQ){ah.fillStyle=aQ;m=aQ;}}function Z(aQ){if(aN.length!==aQ.length){ah.setLineDash(aQ);aN=aQ;}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0;this.renderOrder=0;};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.normalModel=new THREE.Vector3();this.vertexNormalsModel=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=new THREE.Color();this.material=null;this.uvs=[new THREE.Vector2(),new THREE.Vector2(),new THREE.Vector2()];this.z=0;this.renderOrder=0;};THREE.RenderableVertex=function(){this.position=new THREE.Vector3();this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true;};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen);};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.vertexColors=[new THREE.Color(),new THREE.Color()];this.material=null;this.z=0;this.renderOrder=0;};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2();this.material=null;this.renderOrder=0;};THREE.Projector=function(){var R,K,B=[],a=0,s,v,j=[],m=0,z,g,d=[],q=0,l,A,i=[],J=0,Q,F,y=[],I=0,M={objects:[],lights:[],elements:[]},p=new THREE.Vector3(),w=new THREE.Vector4(),t=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),G=new THREE.Box3(),b=new Array(3),n=new Array(4),f=new THREE.Matrix4(),u=new THREE.Matrix4(),E,x=new THREE.Matrix4(),L=new THREE.Matrix3(),P=new THREE.Frustum(),r=new THREE.Vector4(),O=new THREE.Vector4();this.projectVector=function(T,S){console.warn("THREE.Projector: .projectVector() is now vector.project().");T.project(S);};this.unprojectVector=function(T,S){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");T.unproject(S);};this.pickingRay=function(T,S){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().");};var o=function(){var ab=[];var Y=[];var X=null;var W=null;var Z=new THREE.Matrix3();var ac=function(ag){X=ag;W=X.material;Z.getNormalMatrix(X.matrixWorld);ab.length=0;Y.length=0;};var ae=function(ag){var aj=ag.position;var ai=ag.positionWorld;var ah=ag.positionScreen;ai.copy(aj).applyMatrix4(E);ah.copy(ai).applyMatrix4(u);var ak=1/ah.w;ah.x*=ak;ah.y*=ak;ah.z*=ak;ag.visible=ah.x>=-1&&ah.x<=1&&ah.y>=-1&&ah.y<=1&&ah.z>=-1&&ah.z<=1;};var S=function(ah,ai,ag){s=H();s.position.set(ah,ai,ag);ae(s);};var U=function(ah,ai,ag){ab.push(ah,ai,ag);};var V=function(ag,ah){Y.push(ag,ah);};var ad=function(ag,ah,ai){if(ag.visible===true||ah.visible===true||ai.visible===true){return true;}b[0]=ag.positionScreen;b[1]=ah.positionScreen;b[2]=ai.positionScreen;return t.isIntersectionBox(G.setFromPoints(b));};var aa=function(ag,ah,ai){return((ai.positionScreen.x-ag.positionScreen.x)*(ah.positionScreen.y-ag.positionScreen.y)-(ai.positionScreen.y-ag.positionScreen.y)*(ah.positionScreen.x-ag.positionScreen.x))<0;};var T=function(ag,aj){var ah=j[ag];var ai=j[aj];l=c();l.id=X.id;l.v1.copy(ah);l.v2.copy(ai);l.z=(ah.positionScreen.z+ai.positionScreen.z)/2;l.renderOrder=X.renderOrder;l.material=X.material;M.elements.push(l);};var af=function(ag,ai,ak){var al=j[ag];var am=j[ai];var ao=j[ak];if(ad(al,am,ao)===false){return;}if(W.side===THREE.DoubleSide||aa(al,am,ao)===true){z=N();z.id=X.id;z.v1.copy(al);z.v2.copy(am);z.v3.copy(ao);z.z=(al.positionScreen.z+am.positionScreen.z+ao.positionScreen.z)/3;z.renderOrder=X.renderOrder;z.normalModel.fromArray(ab,ag*3);z.normalModel.applyMatrix3(Z).normalize();for(var ah=0;ah<3;ah++){var aj=z.vertexNormalsModel[ah];aj.fromArray(ab,arguments[ah]*3);aj.applyMatrix3(Z).normalize();var an=z.uvs[ah];an.fromArray(Y,arguments[ah]*2);}z.vertexNormalsLength=3;z.material=X.material;M.elements.push(z);}};return{setObject:ac,projectVertex:ae,checkTriangleVisibility:ad,checkBackfaceCulling:aa,pushVertex:S,pushNormal:U,pushUv:V,pushLine:T,pushTriangle:af};};var e=new o();this.projectScene=function(aP,aM,ab,T){g=0;A=0;F=0;M.elements.length=0;if(aP.autoUpdate===true){aP.updateMatrixWorld();}if(aM.parent===null){aM.updateMatrixWorld();}f.copy(aM.matrixWorldInverse.getInverse(aM.matrixWorld));u.multiplyMatrices(aM.projectionMatrix,f);P.setFromMatrix(u);K=0;M.objects.length=0;M.lights.length=0;aP.traverseVisible(function(aR){if(aR instanceof THREE.Light){M.lights.push(aR);}else{if(aR instanceof THREE.Mesh||aR instanceof THREE.Line||aR instanceof THREE.Sprite){var aQ=aR.material;if(aQ.visible===false){return;}if(aR.frustumCulled===false||P.intersectsObject(aR)===true){R=C();R.id=aR.id;R.object=aR;p.setFromMatrixPosition(aR.matrixWorld);p.applyProjection(u);R.z=p.z;R.renderOrder=aR.renderOrder;M.objects.push(R);}}}});if(ab===true){M.objects.sort(k);}for(var an=0,af=M.objects.length;an<af;an++){var ad=M.objects[an].object;var ae=ad.geometry;e.setObject(ad);E=ad.matrixWorld;v=0;if(ad instanceof THREE.Mesh){if(ae instanceof THREE.BufferGeometry){var ax=ae.attributes;
var S=ae.groups;if(ax.position===undefined){continue;}var ar=ax.position.array;for(var aI=0,ak=ar.length;aI<ak;aI+=3){e.pushVertex(ar[aI],ar[aI+1],ar[aI+2]);}if(ax.normal!==undefined){var aH=ax.normal.array;for(var aI=0,ak=aH.length;aI<ak;aI+=3){e.pushNormal(aH[aI],aH[aI+1],aH[aI+2]);}}if(ax.uv!==undefined){var aD=ax.uv.array;for(var aI=0,ak=aD.length;aI<ak;aI+=2){e.pushUv(aD[aI],aD[aI+1]);}}if(ae.index!==null){var av=ae.index.array;if(S.length>0){for(var an=0;an<S.length;an++){var W=S[an];for(var aI=W.start,ak=W.start+W.count;aI<ak;aI+=3){e.pushTriangle(av[aI],av[aI+1],av[aI+2]);}}}else{for(var aI=0,ak=av.length;aI<ak;aI+=3){e.pushTriangle(av[aI],av[aI+1],av[aI+2]);}}}else{for(var aI=0,ak=ar.length/3;aI<ak;aI+=3){e.pushTriangle(aI,aI+1,aI+2);}}}else{if(ae instanceof THREE.Geometry){var aG=ae.vertices;var au=ae.faces;var az=ae.faceVertexUvs[0];L.getNormalMatrix(E);var ay=ad.material;var Z=ay instanceof THREE.MeshFaceMaterial;var ah=Z===true?ad.material:null;for(var aj=0,aB=aG.length;aj<aB;aj++){var aL=aG[aj];p.copy(aL);if(ay.morphTargets===true){var aa=ae.morphTargets;var aJ=ad.morphTargetInfluences;for(var am=0,X=aa.length;am<X;am++){var ag=aJ[am];if(ag===0){continue;}var aK=aa[am];var ap=aK.vertices[aj];p.x+=(ap.x-aL.x)*ag;p.y+=(ap.y-aL.y)*ag;p.z+=(ap.z-aL.z)*ag;}}e.pushVertex(p.x,p.y,p.z);}for(var aN=0,Y=au.length;aN<Y;aN++){var V=au[aN];ay=Z===true?ah.materials[V.materialIndex]:ad.material;if(ay===undefined){continue;}var at=ay.side;var aq=j[V.a];var aO=j[V.b];var aE=j[V.c];if(e.checkTriangleVisibility(aq,aO,aE)===false){continue;}var aA=e.checkBackfaceCulling(aq,aO,aE);if(at!==THREE.DoubleSide){if(at===THREE.FrontSide&&aA===false){continue;}if(at===THREE.BackSide&&aA===true){continue;}}z=N();z.id=ad.id;z.v1.copy(aq);z.v2.copy(aO);z.v3.copy(aE);z.normalModel.copy(V.normal);if(aA===false&&(at===THREE.BackSide||at===THREE.DoubleSide)){z.normalModel.negate();}z.normalModel.applyMatrix3(L).normalize();var aC=V.vertexNormals;for(var U=0,ac=Math.min(aC.length,3);U<ac;U++){var aF=z.vertexNormalsModel[U];aF.copy(aC[U]);if(aA===false&&(at===THREE.BackSide||at===THREE.DoubleSide)){aF.negate();}aF.applyMatrix3(L).normalize();}z.vertexNormalsLength=aC.length;var al=az[aN];if(al!==undefined){for(var ai=0;ai<3;ai++){z.uvs[ai].copy(al[ai]);}}z.color=V.color;z.material=ay;z.z=(aq.positionScreen.z+aO.positionScreen.z+aE.positionScreen.z)/3;z.renderOrder=ad.renderOrder;M.elements.push(z);}}}}else{if(ad instanceof THREE.Line){if(ae instanceof THREE.BufferGeometry){var ax=ae.attributes;if(ax.position!==undefined){var ar=ax.position.array;for(var aI=0,ak=ar.length;aI<ak;aI+=3){e.pushVertex(ar[aI],ar[aI+1],ar[aI+2]);}if(ae.index!==null){var av=ae.index.array;for(var aI=0,ak=av.length;aI<ak;aI+=2){e.pushLine(av[aI],av[aI+1]);}}else{var aw=ad instanceof THREE.LineSegments?2:1;for(var aI=0,ak=(ar.length/3)-1;aI<ak;aI+=aw){e.pushLine(aI,aI+1);}}}}else{if(ae instanceof THREE.Geometry){x.multiplyMatrices(u,E);var aG=ad.geometry.vertices;if(aG.length===0){continue;}aq=H();aq.positionScreen.copy(aG[0]).applyMatrix4(x);var aw=ad instanceof THREE.LineSegments?2:1;for(var aj=1,aB=aG.length;aj<aB;aj++){aq=H();aq.positionScreen.copy(aG[aj]).applyMatrix4(x);if((aj+1)%aw>0){continue;}aO=j[v-2];r.copy(aq.positionScreen);O.copy(aO.positionScreen);if(D(r,O)===true){r.multiplyScalar(1/r.w);O.multiplyScalar(1/O.w);l=c();l.id=ad.id;l.v1.positionScreen.copy(r);l.v2.positionScreen.copy(O);l.z=Math.max(r.z,O.z);l.renderOrder=ad.renderOrder;l.material=ad.material;if(ad.material.vertexColors===THREE.VertexColors){l.vertexColors[0].copy(ad.geometry.colors[aj]);l.vertexColors[1].copy(ad.geometry.colors[aj-1]);}M.elements.push(l);}}}}}else{if(ad instanceof THREE.Sprite){w.set(E.elements[12],E.elements[13],E.elements[14],1);w.applyMatrix4(u);var ao=1/w.w;w.z*=ao;if(w.z>=-1&&w.z<=1){Q=h();Q.id=ad.id;Q.x=w.x*ao;Q.y=w.y*ao;Q.z=w.z;Q.renderOrder=ad.renderOrder;Q.object=ad;Q.rotation=ad.rotation;Q.scale.x=ad.scale.x*Math.abs(Q.x-(w.x+aM.projectionMatrix.elements[0])/(w.w+aM.projectionMatrix.elements[12]));Q.scale.y=ad.scale.y*Math.abs(Q.y-(w.y+aM.projectionMatrix.elements[5])/(w.w+aM.projectionMatrix.elements[13]));Q.material=ad.material;M.elements.push(Q);}}}}}if(T===true){M.elements.sort(k);}return M;};function C(){if(K===a){var S=new THREE.RenderableObject();B.push(S);a++;K++;return S;}return B[K++];}function H(){if(v===m){var S=new THREE.RenderableVertex();j.push(S);m++;v++;return S;}return j[v++];}function N(){if(g===q){var S=new THREE.RenderableFace();d.push(S);q++;g++;return S;}return d[g++];}function c(){if(A===J){var S=new THREE.RenderableLine();i.push(S);J++;A++;return S;}return i[A++];}function h(){if(F===I){var S=new THREE.RenderableSprite();y.push(S);I++;F++;return S;}return y[F++];}function k(S,T){if(S.renderOrder!==T.renderOrder){return S.renderOrder-T.renderOrder;}else{if(S.z!==T.z){return T.z-S.z;}else{if(S.id!==T.id){return S.id-T.id;}else{return 0;}}}}function D(Z,Y){var X=0,U=1,W=Z.z+Z.w,V=Y.z+Y.w,S=-Z.z+Z.w,T=-Y.z+Y.w;if(W>=0&&V>=0&&S>=0&&T>=0){return true;
}else{if((W<0&&V<0)||(S<0&&T<0)){return false;}else{if(W<0){X=Math.max(X,W/(W-V));}else{if(V<0){U=Math.min(U,W/(W-V));}}if(S<0){X=Math.max(X,S/(S-T));}else{if(T<0){U=Math.min(U,S/(S-T));}}if(U<X){return false;}else{Z.lerp(Y,X);Y.lerp(Z,1-U);return true;}}}}};var MinecraftCharacter,scene,camera,renderer,light;var skinDir="images/minecraft_skin.png";function init(){scene=new THREE.Scene();camera=new THREE.PerspectiveCamera(60,64/96,1,1000);camera.position.set(0,0,3);camera.lookAt(scene.position);loader=new THREE.TextureLoader();MinecraftCharacter=new THREE.Group();var o=THREE.ImageUtils.loadTexture(skinDir);o.magFilter=THREE.NearestFilter;o.minFilter=THREE.NearestFilter;var l=new THREE.MeshPhongMaterial({map:o,side:THREE.FrontSide,transparent:true,alphaTest:0.5});var j=1.05;var v=addBox(0,0,64,64,8,8,8);var y=new THREE.Mesh(v,l);MinecraftCharacter.add(y);var D=addBox(32,0,64,64,8,8,8);var h=new THREE.Mesh(D,l);h.scale.multiplyScalar(j);MinecraftCharacter.add(h);var x=addBox(16,16,64,64,8,12,4);var a=new THREE.Mesh(x,l);a.position.set(0,-10/16,0);MinecraftCharacter.add(a);var g=addBox(16,32,64,64,8,12,4);var A=new THREE.Mesh(g,l);A.position.set(0,-10/16,0);A.scale.multiplyScalar(j);MinecraftCharacter.add(A);var k=addBox(40,16,64,64,4,12,4);var n=new THREE.Mesh(k,l);n.position.set(-6/16,-10/16,0);MinecraftCharacter.add(n);var C=addBox(40,32,64,64,4,12,4);var w=new THREE.Mesh(C,l);w.position.set(-6/16,-10/16,0);w.scale.multiplyScalar(j);MinecraftCharacter.add(w);var c=addBox(32,48,64,64,4,12,4);var p=new THREE.Mesh(c,l);p.position.set(6/16,-10/16,0);MinecraftCharacter.add(p);var b=addBox(48,48,64,64,4,12,4);var d=new THREE.Mesh(b,l);d.position.set(6/16,-10/16,0);d.scale.multiplyScalar(j);MinecraftCharacter.add(d);var m=addBox(0,16,64,64,4,12,4);var f=new THREE.Mesh(m,l);f.position.set(-2/16,-22/16,0);MinecraftCharacter.add(f);var i=addBox(0,48,64,64,4,12,4);var B=new THREE.Mesh(i,l);B.position.set(-2/16,-22/16,0);B.scale.multiplyScalar(j);MinecraftCharacter.add(B);var e=addBox(16,48,64,64,4,12,4);var q=new THREE.Mesh(e,l);q.position.set(2/16,-22/16,0);MinecraftCharacter.add(q);var r=addBox(0,32,64,64,4,12,4);var z=new THREE.Mesh(r,l);z.position.set(2/16,-22/16,0);z.scale.multiplyScalar(j);MinecraftCharacter.add(z);MinecraftCharacter.position.set(0,8/16,0);scene.add(MinecraftCharacter);light=new THREE.DirectionalLight(16777215,1);light.position.set(2,3,1);scene.add(light);var s=new THREE.AmbientLight(13421772);scene.add(s);if(Detector.webgl){renderer=new THREE.WebGLRenderer({alpha:true});}else{renderer=new THREE.CanvasRenderer({alpha:true});}renderer.setPixelRatio(window.devicePixelRatio);renderer.setClearColor(16777215,0);renderer.setSize(64,96);renderer.domElement.style.zIndex="10001";renderer.domElement.style.position="fixed";renderer.domElement.style.bottom="0px";renderer.domElement.style.right="0px";document.body.appendChild(renderer.domElement);var t=window.navigator.msPointerEnabled?"MSPointerMove":"touchmove";var u=true;window.addEventListener("mousemove",function(G){u=false;var F=((G.clientX/2)-(window.innerWidth/2))/window.innerWidth;var E=((G.clientY/2)-(window.innerHeight/2))/window.innerHeight;y.rotation.x=E;h.rotation.x=E;y.rotation.y=F;h.rotation.y=F;u=true;},false);window.addEventListener(t,function(G){if(u){var F=((G.touches[0].clientX/2)-(window.innerWidth/2))/window.innerWidth;var E=((G.touches[0].clientY/2)-(window.innerHeight/2))/window.innerHeight;y.rotation.x=E;h.rotation.x=E;y.rotation.y=F;h.rotation.y=F;}},false);render();}function render(){requestAnimationFrame(render);renderer.render(scene,camera);}var addBox=function(l,k,q,j,p,f,o){var d=l;var c=l+o;var x=l+o+p;var h=l+o+p+o;var t=l+o+p+o+p;var e=j-k;var r=j-k-o;var a=j-k-o-f;var b=UVCoordinateSet(x,c,a,r,q,j);var i=UVCoordinateSet(x,c,r,e,q,j);var s=UVCoordinateSet(h,x,r,e,q,j);var g=UVCoordinateSet(t,h,a,r,q,j);var m=UVCoordinateSet(c,d,a,r,q,j);var n=UVCoordinateSet(h,x,a,r,q,j);var w=new THREE.CubeGeometry(p/16,f/16,o/16);w.faceVertexUvs[0]=[];w.faceVertexUvs[0][8]=[b[0],b[1],b[3]];w.faceVertexUvs[0][9]=[b[1],b[2],b[3]];w.faceVertexUvs[0][4]=[i[0],i[1],i[3]];w.faceVertexUvs[0][5]=[i[1],i[2],i[3]];w.faceVertexUvs[0][2]=[n[0],n[1],n[3]];w.faceVertexUvs[0][3]=[n[1],n[2],n[3]];w.faceVertexUvs[0][0]=[m[0],m[1],m[3]];w.faceVertexUvs[0][1]=[m[1],m[2],m[3]];w.faceVertexUvs[0][10]=[g[0],g[1],g[3]];w.faceVertexUvs[0][11]=[g[1],g[2],g[3]];w.faceVertexUvs[0][6]=[s[0],s[1],s[3]];w.faceVertexUvs[0][7]=[s[1],s[2],s[3]];return w;};function UVCoordinateSet(e,c,d,f,b,a){return[new THREE.Vector2(c/b,f/a),new THREE.Vector2(c/b,d/a),new THREE.Vector2(e/b,d/a),new THREE.Vector2(e/b,f/a)];}init();